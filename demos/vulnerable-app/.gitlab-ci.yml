stages:
  - novulnapp
  - dast_zap
  
run_novuln_app:
  image:
    name: registry.gitlab.com/2-dast-2-continuos/dasttool-alpa:2.0.0
    entrypoint: [""]
  services:
    - docker:app-run
  script:
    - npm install -g gulp
    - npm install
    - gulp
  artifacts:
    name: myReport
    when: on_failure
    paths:
      - data-output.json
  tags:
    - docker
    - test
    - dast
  stage: novulnapp
  only:
    - master

run_dast_zap:
  image: docker:stable
  variables:
    DOCKER_DRIVER: overlay2
  allow_failure: true
  services:
    - docker:stable-dind
  script:
    - docker run 
      -v $(pwd):/zap/wrk/:rw 
      -i registry.gitlab.com/gitlab-org/security-products/dast:latest 
      /analyze -t  http://70.37.59.239/bWAPP/sqli_1.php 
      -r report.html
      --auth-url http://70.37.59.239/bWAPP/login.php 
      --auth-username bee 
      --auth-password bug 
      --auth-username-field login 
      --auth-password-field password 
      --auth-submit-field form 

     
  artifacts:
    reports:
      dast: gl-dast-report.json
  stage: dast_zap
  only:
    - test-zap